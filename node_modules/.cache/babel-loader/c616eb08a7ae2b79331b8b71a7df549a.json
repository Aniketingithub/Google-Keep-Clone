{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { Keys, classNames, dispatchEvent } from '@progress/kendo-react-common';\nimport * as PropTypes from 'prop-types';\nimport * as React from 'react';\nimport { convertMsgsToViewItems } from './../ViewItem';\nimport ActionGroup from './ActionGroup';\nimport AttachmentGroup from './AttachmentGroup';\nimport DateMarker from './DateMarker';\nimport MessageGroup from './MessageGroup';\nimport NewMessage from './NewMessage';\nimport { ChatMessage } from './ChatMessage';\nimport { validatePackage } from '@progress/kendo-licensing';\nimport { packageMetadata } from '../package-metadata';\n/**\n * Represents the [KendoReact Chat component]({% slug overview_convui %}).\n */\n\nvar Chat =\n/** @class */\nfunction (_super) {\n  __extends(Chat, _super);\n\n  function Chat(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.scrollToBottomOnLoadingData = true;\n\n    _this.onFocus = function () {\n      clearTimeout(_this.timeoutIdForChatLosingFocus);\n    };\n\n    _this.onBlur = function () {\n      // This is a hacky solution to clear the selection when the focus is lost\n      // in favor of an element outside the Chat.\n      // https://medium.com/@jessebeach/dealing-with-focus-and-blur-in-a-composite-widget-in-react-90d3c3b49a9b\n      _this.timeoutIdForChatLosingFocus = window.setTimeout(function () {\n        _this.setState({\n          selectedItemIndex: null\n        });\n      }, 0);\n    };\n\n    _this.onSelectionRequested = function (clickedItemIndex) {\n      _this.setState({\n        selectedItemIndex: clickedItemIndex\n      });\n    };\n\n    _this.onKeyDown = function (event) {\n      var newSelectedItemIndex = null;\n      var currentSelectedItemIndex = _this.state.selectedItemIndex !== null ? _this.state.selectedItemIndex : _this.viewItems.lastSelectionIndex;\n\n      if (event.keyCode === Keys.up) {\n        if (currentSelectedItemIndex === null) {\n          newSelectedItemIndex = 0;\n        } else if (currentSelectedItemIndex > 0) {\n          newSelectedItemIndex = currentSelectedItemIndex - 1;\n        }\n      } else if (event.keyCode === Keys.down) {\n        if (currentSelectedItemIndex === null) {\n          newSelectedItemIndex = 0;\n        } else if (currentSelectedItemIndex < _this.viewItems.lastSelectionIndex) {\n          newSelectedItemIndex = currentSelectedItemIndex + 1;\n        }\n      }\n\n      if (newSelectedItemIndex !== null) {\n        _this.setState({\n          selectedItemIndex: newSelectedItemIndex\n        }); // Prevent the default behavior of moving of the scrollbar\n        // because scrolling is achieved through item focusing.\n\n\n        event.preventDefault();\n      }\n    };\n\n    _this.onMessageSend = function (message, event) {\n      dispatchEvent(_this.props.onMessageSend, event, _this, {\n        message: message\n      });\n    };\n\n    _this.onActionExecute = function (action, event) {\n      dispatchEvent(_this.props.onActionExecute, event, _this, {\n        action: action\n      });\n\n      if (!event.isDefaultPrevented()) {\n        switch (action.type) {\n          case 'reply':\n            _this.onMessageSend({\n              author: _this.props.user,\n              text: action.value,\n              timestamp: new Date()\n            }, event);\n\n            break;\n\n          case 'call':\n            window.open('tel:' + action.value);\n            break;\n\n          case 'openUrl':\n            window.open(action.value);\n            break;\n\n          default:\n            break;\n        }\n\n        _this.newMsgComp.focusInput();\n      }\n    };\n\n    validatePackage(packageMetadata);\n    _this.state = {\n      selectedItemIndex: null,\n      isFirstRender: true\n    };\n    return _this;\n  }\n  /**\n   * @hidden\n   */\n\n\n  Chat.prototype.render = function () {\n    var _this = this;\n\n    this.viewItems = this.getViewItemsFromMsgs(this.props.messages);\n    this.isDirectionRightToLeft = this.checkIsDirectionRightToLeft(this.props);\n    return React.createElement(\"div\", {\n      style: {\n        width: this.props.width\n      },\n      onKeyDown: this.onKeyDown,\n      className: this.getClassNames(),\n      ref: function (el) {\n        return _this.chatWrapperEl = el;\n      }\n    }, React.createElement(\"div\", {\n      className: \"k-message-list k-avatars\",\n      onBlur: this.onBlur,\n      onFocus: this.onFocus,\n      role: \"log\",\n      \"aria-live\": \"polite\",\n      onScroll: function (e) {\n        _this.scrollToBottomOnLoadingData = e.currentTarget.scrollTop === e.currentTarget.scrollHeight - e.currentTarget.clientHeight;\n      },\n      ref: function (el) {\n        return _this.viewItemsWrapperEl = el;\n      }\n    }, React.createElement(\"div\", {\n      className: \"k-message-list-content\"\n    }, this.renderViewItems())), React.createElement(NewMessage, {\n      user: this.props.user,\n      onMessageSend: this.onMessageSend,\n      isDirectionRightToLeft: this.isDirectionRightToLeft,\n      ref: function (comp) {\n        return _this.newMsgComp = comp;\n      },\n      placeholder: this.props.placeholder,\n      MessageBox: this.props.messageBox,\n      toolbar: this.props.toolbar,\n      onToolbarActionButtonClick: this.props.onToolbarActionExecute,\n      showToolbar: this.props.showToolbar\n    }));\n  };\n  /**\n   * @hidden\n   */\n\n\n  Chat.prototype.componentDidMount = function () {\n    var _this = this;\n\n    this.setState({\n      isFirstRender: false\n    }, function () {\n      // W/o window.setTimeout the scrolling does not manage to go to the bottom, some offset is left.\n      _this.nextTickId = window.setTimeout(function () {\n        return _this.scrollViewItemsToBottom();\n      }, 250);\n    });\n  };\n  /**\n   * @hidden\n   */\n\n\n  Chat.prototype.componentWillUnmount = function () {\n    clearTimeout(this.nextTickId);\n  };\n  /**\n   * @hidden\n   */\n\n\n  Chat.prototype.componentDidUpdate = function (prevProps) {\n    if (prevProps.messages.length !== this.props.messages.length && this.scrollToBottomOnLoadingData) {\n      this.scrollViewItemsToBottom();\n    }\n  };\n\n  Chat.prototype.getClassNames = function () {\n    return classNames('k-widget', 'k-chat', this.props.className, {\n      'k-rtl': this.isDirectionRightToLeft\n    });\n  };\n\n  Chat.prototype.checkIsDirectionRightToLeft = function (props) {\n    var result = props.dir !== undefined ? props.dir === 'rtl' : this.chatWrapperEl && getComputedStyle(this.chatWrapperEl).direction === 'rtl';\n    return Boolean(result);\n  };\n\n  Chat.prototype.renderViewItems = function () {\n    var _this = this;\n\n    var lastViewItemIndex = this.viewItems.length - 1;\n    return this.viewItems.map(function (viewItem, index) {\n      if (viewItem.type === 'date-marker') {\n        return React.createElement(DateMarker, {\n          item: viewItem,\n          key: index\n        });\n      } else if (viewItem.type === 'message-group') {\n        return React.createElement(MessageGroup, {\n          group: viewItem,\n          itemTemplate: _this.props.messageTemplate,\n          attachmentTemplate: _this.props.attachmentTemplate,\n          user: _this.props.user,\n          selectedItemIndex: _this.state.selectedItemIndex,\n          onRequestSelection: _this.onSelectionRequested,\n          isLastGroup: index === lastViewItemIndex,\n          key: index,\n          message: _this.props.message || Chat.defaultProps.message\n        });\n      } else if (viewItem.type === 'attachment-group') {\n        return React.createElement(AttachmentGroup, {\n          group: viewItem,\n          itemTemplate: _this.props.attachmentTemplate,\n          onRequestSelection: _this.onSelectionRequested,\n          selected: viewItem.selectionIndex === _this.state.selectedItemIndex,\n          isLastGroup: index === lastViewItemIndex,\n          key: index\n        });\n      } else if (viewItem.type === 'action-group') {\n        return React.createElement(ActionGroup, {\n          group: viewItem,\n          onActionExecute: _this.onActionExecute,\n          onRequestSelection: _this.onSelectionRequested,\n          selected: viewItem.selectionIndex === _this.state.selectedItemIndex,\n          isLastGroup: index === lastViewItemIndex,\n          key: index\n        });\n      }\n    });\n  };\n\n  Chat.prototype.scrollViewItemsToBottom = function () {\n    if (this.viewItemsWrapperEl) {\n      this.viewItemsWrapperEl.scrollTop = this.viewItemsWrapperEl.scrollHeight - this.viewItemsWrapperEl.clientHeight;\n    }\n  };\n\n  Chat.prototype.getViewItemsFromMsgs = function (msgs) {\n    return msgs.length > 0 ? convertMsgsToViewItems(msgs) : [];\n  };\n  /**\n   * @hidden\n   */\n\n\n  Chat.propTypes = {\n    messages: PropTypes.arrayOf(PropTypes.object),\n    user: PropTypes.object,\n    messageTemplate: PropTypes.any,\n    attachmentTemplate: PropTypes.any,\n    width: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n    onMessageSend: PropTypes.func,\n    onActionExecute: PropTypes.func,\n    dir: PropTypes.string,\n    messageBox: PropTypes.any\n  };\n  /**\n   * @hidden\n   */\n\n  Chat.defaultProps = {\n    messages: [],\n    dateFormat: 'g',\n    message: ChatMessage\n  };\n  return Chat;\n}(React.Component);\n\nexport { Chat };","map":{"version":3,"sources":["../../../src/components/Chat.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { Keys, classNames, dispatchEvent } from '@progress/kendo-react-common';\nimport * as PropTypes from 'prop-types';\nimport * as React from 'react';\nimport { convertMsgsToViewItems } from './../ViewItem';\nimport ActionGroup from './ActionGroup';\nimport AttachmentGroup from './AttachmentGroup';\nimport DateMarker from './DateMarker';\nimport MessageGroup from './MessageGroup';\nimport NewMessage from './NewMessage';\nimport { ChatMessage } from './ChatMessage';\nimport { validatePackage } from '@progress/kendo-licensing';\nimport { packageMetadata } from '../package-metadata';\n/**\n * Represents the [KendoReact Chat component]({% slug overview_convui %}).\n */\nvar Chat = /** @class */ (function (_super) {\n    __extends(Chat, _super);\n    function Chat(props) {\n        var _this = _super.call(this, props) || this;\n        _this.scrollToBottomOnLoadingData = true;\n        _this.onFocus = function () {\n            clearTimeout(_this.timeoutIdForChatLosingFocus);\n        };\n        _this.onBlur = function () {\n            // This is a hacky solution to clear the selection when the focus is lost\n            // in favor of an element outside the Chat.\n            // https://medium.com/@jessebeach/dealing-with-focus-and-blur-in-a-composite-widget-in-react-90d3c3b49a9b\n            _this.timeoutIdForChatLosingFocus = window.setTimeout(function () { _this.setState({ selectedItemIndex: null }); }, 0);\n        };\n        _this.onSelectionRequested = function (clickedItemIndex) {\n            _this.setState({ selectedItemIndex: clickedItemIndex });\n        };\n        _this.onKeyDown = function (event) {\n            var newSelectedItemIndex = null;\n            var currentSelectedItemIndex = _this.state.selectedItemIndex !== null ?\n                _this.state.selectedItemIndex :\n                _this.viewItems.lastSelectionIndex;\n            if (event.keyCode === Keys.up) {\n                if (currentSelectedItemIndex === null) {\n                    newSelectedItemIndex = 0;\n                }\n                else if (currentSelectedItemIndex > 0) {\n                    newSelectedItemIndex = currentSelectedItemIndex - 1;\n                }\n            }\n            else if (event.keyCode === Keys.down) {\n                if (currentSelectedItemIndex === null) {\n                    newSelectedItemIndex = 0;\n                }\n                else if (currentSelectedItemIndex < _this.viewItems.lastSelectionIndex) {\n                    newSelectedItemIndex = currentSelectedItemIndex + 1;\n                }\n            }\n            if (newSelectedItemIndex !== null) {\n                _this.setState({ selectedItemIndex: newSelectedItemIndex });\n                // Prevent the default behavior of moving of the scrollbar\n                // because scrolling is achieved through item focusing.\n                event.preventDefault();\n            }\n        };\n        _this.onMessageSend = function (message, event) {\n            dispatchEvent(_this.props.onMessageSend, event, _this, { message: message });\n        };\n        _this.onActionExecute = function (action, event) {\n            dispatchEvent(_this.props.onActionExecute, event, _this, { action: action });\n            if (!event.isDefaultPrevented()) {\n                switch (action.type) {\n                    case 'reply':\n                        _this.onMessageSend({\n                            author: _this.props.user,\n                            text: action.value,\n                            timestamp: new Date()\n                        }, event);\n                        break;\n                    case 'call':\n                        window.open('tel:' + action.value);\n                        break;\n                    case 'openUrl':\n                        window.open(action.value);\n                        break;\n                    default:\n                        break;\n                }\n                _this.newMsgComp.focusInput();\n            }\n        };\n        validatePackage(packageMetadata);\n        _this.state = { selectedItemIndex: null, isFirstRender: true };\n        return _this;\n    }\n    /**\n     * @hidden\n     */\n    Chat.prototype.render = function () {\n        var _this = this;\n        this.viewItems = this.getViewItemsFromMsgs(this.props.messages);\n        this.isDirectionRightToLeft = this.checkIsDirectionRightToLeft(this.props);\n        return (React.createElement(\"div\", { style: { width: this.props.width }, onKeyDown: this.onKeyDown, className: this.getClassNames(), ref: function (el) { return _this.chatWrapperEl = el; } },\n            React.createElement(\"div\", { className: \"k-message-list k-avatars\", onBlur: this.onBlur, onFocus: this.onFocus, role: \"log\", \"aria-live\": \"polite\", onScroll: function (e) {\n                    _this.scrollToBottomOnLoadingData =\n                        (e.currentTarget.scrollTop === e.currentTarget.scrollHeight - e.currentTarget.clientHeight);\n                }, ref: function (el) { return _this.viewItemsWrapperEl = el; } },\n                React.createElement(\"div\", { className: \"k-message-list-content\" }, this.renderViewItems())),\n            React.createElement(NewMessage, { user: this.props.user, onMessageSend: this.onMessageSend, isDirectionRightToLeft: this.isDirectionRightToLeft, ref: function (comp) { return _this.newMsgComp = comp; }, placeholder: this.props.placeholder, MessageBox: this.props.messageBox, toolbar: this.props.toolbar, onToolbarActionButtonClick: this.props.onToolbarActionExecute, showToolbar: this.props.showToolbar })));\n    };\n    /**\n     * @hidden\n     */\n    Chat.prototype.componentDidMount = function () {\n        var _this = this;\n        this.setState({ isFirstRender: false }, function () {\n            // W/o window.setTimeout the scrolling does not manage to go to the bottom, some offset is left.\n            _this.nextTickId = window.setTimeout(function () { return _this.scrollViewItemsToBottom(); }, 250);\n        });\n    };\n    /**\n     * @hidden\n     */\n    Chat.prototype.componentWillUnmount = function () {\n        clearTimeout(this.nextTickId);\n    };\n    /**\n     * @hidden\n     */\n    Chat.prototype.componentDidUpdate = function (prevProps) {\n        if (prevProps.messages.length !== this.props.messages.length && this.scrollToBottomOnLoadingData) {\n            this.scrollViewItemsToBottom();\n        }\n    };\n    Chat.prototype.getClassNames = function () {\n        return classNames('k-widget', 'k-chat', this.props.className, { 'k-rtl': this.isDirectionRightToLeft });\n    };\n    Chat.prototype.checkIsDirectionRightToLeft = function (props) {\n        var result = props.dir !== undefined ? props.dir === 'rtl' :\n            this.chatWrapperEl && getComputedStyle(this.chatWrapperEl).direction === 'rtl';\n        return Boolean(result);\n    };\n    Chat.prototype.renderViewItems = function () {\n        var _this = this;\n        var lastViewItemIndex = this.viewItems.length - 1;\n        return this.viewItems\n            .map(function (viewItem, index) {\n            if (viewItem.type === 'date-marker') {\n                return React.createElement(DateMarker, { item: viewItem, key: index });\n            }\n            else if (viewItem.type === 'message-group') {\n                return (React.createElement(MessageGroup, { group: viewItem, itemTemplate: _this.props.messageTemplate, attachmentTemplate: _this.props.attachmentTemplate, user: _this.props.user, selectedItemIndex: _this.state.selectedItemIndex, onRequestSelection: _this.onSelectionRequested, isLastGroup: index === lastViewItemIndex, key: index, message: _this.props.message || Chat.defaultProps.message }));\n            }\n            else if (viewItem.type === 'attachment-group') {\n                return (React.createElement(AttachmentGroup, { group: viewItem, itemTemplate: _this.props.attachmentTemplate, onRequestSelection: _this.onSelectionRequested, selected: viewItem.selectionIndex === _this.state.selectedItemIndex, isLastGroup: index === lastViewItemIndex, key: index }));\n            }\n            else if (viewItem.type === 'action-group') {\n                return (React.createElement(ActionGroup, { group: viewItem, onActionExecute: _this.onActionExecute, onRequestSelection: _this.onSelectionRequested, selected: viewItem.selectionIndex === _this.state.selectedItemIndex, isLastGroup: index === lastViewItemIndex, key: index }));\n            }\n        });\n    };\n    Chat.prototype.scrollViewItemsToBottom = function () {\n        if (this.viewItemsWrapperEl) {\n            this.viewItemsWrapperEl.scrollTop =\n                this.viewItemsWrapperEl.scrollHeight - this.viewItemsWrapperEl.clientHeight;\n        }\n    };\n    Chat.prototype.getViewItemsFromMsgs = function (msgs) {\n        return msgs.length > 0 ? convertMsgsToViewItems(msgs) : [];\n    };\n    /**\n     * @hidden\n     */\n    Chat.propTypes = {\n        messages: PropTypes.arrayOf(PropTypes.object),\n        user: PropTypes.object,\n        messageTemplate: PropTypes.any,\n        attachmentTemplate: PropTypes.any,\n        width: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n        onMessageSend: PropTypes.func,\n        onActionExecute: PropTypes.func,\n        dir: PropTypes.string,\n        messageBox: PropTypes.any\n    };\n    /**\n     * @hidden\n     */\n    Chat.defaultProps = {\n        messages: [],\n        dateFormat: 'g',\n        message: ChatMessage\n    };\n    return Chat;\n}(React.Component));\nexport { Chat };\n//# sourceMappingURL=Chat.js.map"]},"metadata":{},"sourceType":"module"}