{"ast":null,"code":"import { isAuthor } from './utils';\n\nvar last = function (arr) {\n  return arr[arr.length - 1];\n};\n\nvar dateChanged = function (curr, prev) {\n  return curr && prev && (prev.getDate() !== curr.getDate() || prev.getMonth() !== curr.getMonth() || prev.getFullYear() !== curr.getFullYear());\n};\n\nvar addDateMarker = function (acc, msg) {\n  var timestamp = msg.timestamp;\n  var lastItem = last(acc);\n\n  if (!timestamp) {\n    return;\n  }\n\n  if (!lastItem || dateChanged(timestamp, lastItem.timestamp)) {\n    var dateMarker = {\n      type: 'date-marker',\n      timestamp: timestamp,\n      trackBy: timestamp.getTime()\n    };\n    acc.push(dateMarker);\n  }\n};\n\nvar groupMessages = function (acc, msg, isLastMessage) {\n  var lastItem = last(acc);\n  var messages = undefined;\n\n  if (msg.typing && !isLastMessage) {\n    return;\n  }\n\n  if (lastItem && lastItem.type === 'message-group') {\n    messages = lastItem.messages;\n  }\n\n  if (messages && isAuthor(msg.author, last(messages))) {\n    messages.push(msg);\n  } else {\n    acc.push({\n      type: 'message-group',\n      messages: [msg],\n      author: msg.author,\n      timestamp: msg.timestamp,\n      trackBy: msg\n    });\n  }\n};\n\nvar groupItems = function (total) {\n  return function (acc, msg, index) {\n    var isLastMessage = index === total - 1;\n    addDateMarker(acc, msg);\n    groupMessages(acc, msg, isLastMessage);\n\n    if (msg.attachments && msg.attachments.length > 1) {\n      acc.push({\n        type: 'attachment-group',\n        attachments: msg.attachments,\n        attachmentLayout: msg.attachmentLayout,\n        timestamp: msg.timestamp,\n        trackBy: msg\n      });\n    }\n\n    if (msg.suggestedActions && isLastMessage) {\n      acc.push({\n        type: 'action-group',\n        actions: msg.suggestedActions,\n        timestamp: msg.timestamp,\n        trackBy: msg\n      });\n    }\n\n    return acc;\n  };\n};\n\nfunction assignSelectionIndices(viewItems) {\n  var selectionCounter = 0;\n  viewItems.forEach(function (viewItem) {\n    if (viewItem.type === 'message-group') {\n      viewItem.messages.forEach(function (msg) {\n        msg.selectionIndex = selectionCounter++;\n      });\n    } else if (viewItem.type === 'attachment-group' || viewItem.type === 'action-group') {\n      viewItem.selectionIndex = selectionCounter++;\n    }\n  });\n  viewItems.lastSelectionIndex = selectionCounter - 1;\n}\n/**\n * @hidden\n */\n\n\nexport var convertMsgsToViewItems = function (messages) {\n  var items = messages.slice();\n  var result = items.reduce(groupItems(messages.length), []);\n  assignSelectionIndices(result);\n  return result;\n};","map":{"version":3,"sources":["../../src/ViewItem.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { isAuthor } from './utils';\nvar last = function (arr) { return arr[arr.length - 1]; };\nvar dateChanged = function (curr, prev) {\n    return (curr && prev) && (prev.getDate() !== curr.getDate() ||\n        prev.getMonth() !== curr.getMonth() ||\n        prev.getFullYear() !== curr.getFullYear());\n};\nvar addDateMarker = function (acc, msg) {\n    var timestamp = msg.timestamp;\n    var lastItem = last(acc);\n    if (!timestamp) {\n        return;\n    }\n    if (!lastItem || dateChanged(timestamp, lastItem.timestamp)) {\n        var dateMarker = {\n            type: 'date-marker',\n            timestamp: timestamp,\n            trackBy: timestamp.getTime()\n        };\n        acc.push(dateMarker);\n    }\n};\nvar groupMessages = function (acc, msg, isLastMessage) {\n    var lastItem = last(acc);\n    var messages = undefined;\n    if (msg.typing && !isLastMessage) {\n        return;\n    }\n    if (lastItem && lastItem.type === 'message-group') {\n        messages = lastItem.messages;\n    }\n    if (messages && isAuthor(msg.author, last(messages))) {\n        messages.push(msg);\n    }\n    else {\n        acc.push({\n            type: 'message-group',\n            messages: [msg],\n            author: msg.author,\n            timestamp: msg.timestamp,\n            trackBy: msg\n        });\n    }\n};\nvar groupItems = function (total) { return function (acc, msg, index) {\n    var isLastMessage = index === total - 1;\n    addDateMarker(acc, msg);\n    groupMessages(acc, msg, isLastMessage);\n    if (msg.attachments && msg.attachments.length > 1) {\n        acc.push({\n            type: 'attachment-group',\n            attachments: msg.attachments,\n            attachmentLayout: msg.attachmentLayout,\n            timestamp: msg.timestamp,\n            trackBy: msg\n        });\n    }\n    if (msg.suggestedActions && isLastMessage) {\n        acc.push({\n            type: 'action-group',\n            actions: msg.suggestedActions,\n            timestamp: msg.timestamp,\n            trackBy: msg\n        });\n    }\n    return acc;\n}; };\nfunction assignSelectionIndices(viewItems) {\n    var selectionCounter = 0;\n    viewItems.forEach(function (viewItem) {\n        if (viewItem.type === 'message-group') {\n            viewItem.messages.forEach(function (msg) {\n                msg.selectionIndex = selectionCounter++;\n            });\n        }\n        else if (viewItem.type === 'attachment-group' || viewItem.type === 'action-group') {\n            viewItem.selectionIndex = selectionCounter++;\n        }\n    });\n    viewItems.lastSelectionIndex = selectionCounter - 1;\n}\n/**\n * @hidden\n */\nexport var convertMsgsToViewItems = function (messages) {\n    var items = messages.slice();\n    var result = items.reduce(groupItems(messages.length), []);\n    assignSelectionIndices(result);\n    return result;\n};\n//# sourceMappingURL=ViewItem.js.map"]},"metadata":{},"sourceType":"module"}